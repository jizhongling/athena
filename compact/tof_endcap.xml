<?xml version="1.0" encoding="UTF-8"?>
<lccdd>
  <define>
    <comment>
      --------------------------
      Forward and backward TOF Parameters
      --------------------------
    </comment>
    
    <constant name="TOFEndcapSensor_thickness"  value="0.3*mm"/>
    <constant name="TOFEndcap_thickness"        value="2.00/100*9.37*cm"/>
    <constant name="TOFEndcapService_thickness" value="TOFEndcap_thickness-TOFEndcapSensor_thickness"/>
    <constant name="TOFEndcap_nLayers"          value="2"/>

    <constant name="ForwardTOF_zmin"            value="BarrelTracking_length/2.0 + ForwardTracking_length + ForwardRICH_length + ForwardTRD_length"/>
    <constant name="ForwardTOF_dz"              value="(ForwardTOF_length-0.4*cm)/TOFEndcap_nLayers"/>
    <constant name="ForwardTOF_rmin1"           value="ForwardPID_rmin1"/>
    <constant name="ForwardTOF_rmin2"           value="ForwardPID_rmin1"/>
    <constant name="ForwardTOF_rmax1"           value="Solenoid_rmin"/>
    <constant name="ForwardTOF_rmax2"           value="Solenoid_rmin"/>
    <constant name="ForwardTOFModOpeningAngle"  value="30.0*degree"/>
    <constant name="ForwardTOFMod1_x1"          value="2.0*ForwardTOF_rmin1*sin(ForwardTOFModOpeningAngle/2.0)"/>
    <constant name="ForwardTOFMod1_x2"          value="2.0*ForwardTOF_rmax1*sin(ForwardTOFModOpeningAngle/2.0)"/>
    <constant name="ForwardTOFMod1_y"           value="ForwardTOF_rmax1*cos(ForwardTOFModOpeningAngle/2.0) - ForwardTOF_rmin1"/>
    <constant name="ForwardTOFMod2_x1"          value="2.0*ForwardTOF_rmin2*sin(ForwardTOFModOpeningAngle/2.0)"/>
    <constant name="ForwardTOFMod2_x2"          value="2.0*ForwardTOF_rmax2*sin(ForwardTOFModOpeningAngle/2.0)"/>
    <constant name="ForwardTOFMod2_y"           value="ForwardTOF_rmax2*cos(ForwardTOFModOpeningAngle/2.0) - ForwardTOF_rmin2"/>

    <constant name="BackwardTOF_zmin"           value="BarrelTracking_length/2.0 + BackwardTracking_length + BackwardCherenkov_length "/>
    <constant name="BackwardTOF_dz"             value="(BackwardTOF_length-0.4*cm)/TOFEndcap_nLayers"/>
    <constant name="BackwardTOF_thickness"      value="BackwardTOF_dz - 1.0*mm"/>
    <comment> Note, the -1.0*mm is so the layers do not touch surfaces. 
      This is a limitation of ACTS geometry which will likely go away in the future.</comment>
    <constant name="BackwardTOF_rmin1"          value="ForwardPID_rmin1"/>
    <constant name="BackwardTOF_rmin2"          value="ForwardPID_rmin1"/>
    <constant name="BackwardTOF_rmax1"          value="BarrelTracking_rmax"/>
    <constant name="BackwardTOF_rmax2"          value="BarrelTracking_rmax"/>
    <constant name="BackwardTOFModOpeningAngle" value="30.0*degree"/>
    <constant name="BackwardTOFMod1_x1"         value="2.0*BackwardTOF_rmin1*sin(BackwardTOFModOpeningAngle/2.0)"/>
    <constant name="BackwardTOFMod1_x2"         value="2.0*BackwardTOF_rmax1*sin(BackwardTOFModOpeningAngle/2.0)"/>
    <constant name="BackwardTOFMod1_y"          value="BackwardTOF_rmax1*cos(BackwardTOFModOpeningAngle/2.0) - BackwardTOF_rmin1"/>
    <constant name="BackwardTOFMod2_x1"         value="2.0*BackwardTOF_rmin2*sin(BackwardTOFModOpeningAngle/2.0)"/>
    <constant name="BackwardTOFMod2_x2"         value="2.0*BackwardTOF_rmax2*sin(BackwardTOFModOpeningAngle/2.0)"/>
    <constant name="BackwardTOFMod2_y"          value="BackwardTOF_rmax2*cos(BackwardTOFModOpeningAngle/2.0) - BackwardTOF_rmin2"/>
  </define>

  <detectors>
      <detector
        id="ForwardTOF_ID"
        name="ForwardTOF"
        type="refdet_TrapEndcapTracker"
        readout="TOFEndcapHits"
        vis="TOFVis"
        reflect="false">
        <module name="Module1" vis="OrgangeVis">
          <trd x1="ForwardTOFMod1_x1/2.0" x2="ForwardTOFMod1_x2/2.0" z="ForwardTOFMod1_y/2"/>
          <module_component thickness="ITS3Thickness" material="Silicon" sensitive="true"/>
          <module_component thickness="TOFEndcapService_thickness" material="Silicon"/>
        </module>
        <module name="Module2" vis="OrgangeVis">
          <trd x1="ForwardTOFMod2_x1/2.0" x2="ForwardTOFMod2_x2/2.0" z="ForwardTOFMod2_y/2"/>
          <module_component thickness="TOFEndcapSensor_thickness" material="Silicon" sensitive="true"/>
          <module_component thickness="TOFEndcapService_thickness" material="Silicon"/>
        </module>
        <layer id="1">
          <envelope  vis="TOFVis"
            rmin="ForwardTOF_rmin1"
            rmax="ForwardTOF_rmax1"
            length="BackwardTOF_thickness"
            zstart="ForwardTOF_zmin" />
          <ring vis="AnlRed"
            r="ForwardTOF_rmin1+ForwardTOFMod1_y/2.0"
            zstart="0.0*mm"
            nmodules="12" dz="2.5 * mm" module="Module1" />
        </layer>
        <layer id="2">
          <envelope  vis="TOFVis"
            rmin="ForwardTOF_rmin2"
            rmax="ForwardTOF_rmax2"
            length="BackwardTOF_thickness"
            zstart="ForwardTOF_zmin + ForwardTOF_dz" />
          <ring vis="AnlRed"
            r="ForwardTOF_rmin2+ForwardTOFMod2_y/2.0"
            zstart="0.0*mm"
            nmodules="12" dz="2.5 * mm" module="Module2" />
        </layer>
      </detector>

      <detector
        id="BackwardTOF_ID"
        name="BackwardTOF"
        type="refdet_TrapEndcapTracker"
        readout="TOFEndcapHits"
        vis="TOFVis"
        reflect="true">
        <module name="Module1" vis="OrgangeVis">
          <trd x1="BackwardTOFMod1_x1/2.0" x2="BackwardTOFMod1_x2/2.0" z="BackwardTOFMod1_y/2"/>
          <module_component thickness="TOFEndcapSensor_thickness" material="Silicon" sensitive="true"/>
          <module_component thickness="TOFEndcapService_thickness" material="Silicon"/>
        </module>
        <module name="Module2" vis="OrgangeVis">
          <trd x1="BackwardTOFMod2_x1/2.0" x2="BackwardTOFMod2_x2/2.0" z="BackwardTOFMod2_y/2"/>
          <module_component thickness="TOFEndcapSensor_thickness" material="Silicon" sensitive="true"/>
          <module_component thickness="TOFEndcapService_thickness" material="Silicon"/>
        </module>
        <layer id="1">
          <envelope  vis="TOFVis"
            rmin="BackwardTOF_rmin1 + 0 * 1.2*cm"
            rmax="BackwardTOF_rmax1"
            length="BackwardTOF_thickness"
            zstart="BackwardTOF_zmin" />
          <ring vis="AnlRed"
            r="BackwardTOF_rmin1+BackwardTOFMod1_y/2.0"
            zstart="0.0*mm"
            nmodules="12" dz="2.5 * mm" module="Module1" />
        </layer>
        <layer id="2">
          <envelope  vis="TOFVis"
            rmin="BackwardTOF_rmin2"
            rmax="BackwardTOF_rmax2"
            length="BackwardTOF_thickness"
            zstart="BackwardTOF_zmin + BackwardTOF_dz" />
          <ring vis="AnlRed"
            r="BackwardTOF_rmin2+BackwardTOFMod2_y/2.0"
            zstart="0.0*mm"
            nmodules="12" dz="2.5 * mm" module="Module2" />
        </layer>
      </detector>
  </detectors>
  
  <readouts>
    <readout name="TOFEndcapHits">
      <segmentation type="CartesianGridXY" grid_size_x="0.20*mm" grid_size_y="0.20*mm" />
      <id>system:8,barrel:2,layer:4,module:12,sensor:2,x:32:-16,y:-16</id>
    </readout>
  </readouts>

</lccdd>
